//------------------------------------------------------
// â–¼ æœ€åˆã®ã‚¹ã‚¿ãƒ¼ãƒˆç”»é¢æ“ä½œ
//------------------------------------------------------
document.addEventListener("DOMContentLoaded", () => {
  const startBtn = document.getElementById("startBtn");
  const startScreen = document.getElementById("startScreen");
  const quiz = document.getElementById("quiz");

  startBtn.onclick = () => {
    startScreen.style.display = "none";
    quiz.style.display = "block";
    showQuestion();
  };
});

//------------------------------------------------------
// è³ªå•ãƒ‡ãƒ¼ã‚¿
//------------------------------------------------------
const questions = [
  {
    q: "1. é€æ˜äººé–“ã«ãªã‚ŒãŸã‚‰ä½•ã‚’ã™ã‚‹ï¼Ÿ",
    a: ["äººã®ç”Ÿæ´»ã‚’è¦³å¯Ÿ", "è‡ªç”±ã«å¥½ããªå ´æ‰€ã¸è¡Œã", "èª°ã‹ã®ç§˜å¯†ã‚’æ¢ã‚‹"],
  },
  {
    q: "2. çªç„¶1000å††ãŒé€ã‚‰ã‚Œã¦ããŸã‚‰ï¼Ÿ",
    a: ["ã™ãä½¿ã†", "è²¯ã‚ã¦ãŠã", "äººã«ãƒ—ãƒ¬ã‚¼ãƒ³ãƒˆã™ã‚‹"],
  },
  { q: "3. ç„¡äººå³¶ã«1ã¤æŒã£ã¦ã„ããªã‚‰ï¼Ÿ", a: ["é£Ÿæ–™", "æœ¬", "éŸ³æ¥½ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼"] },
  {
    q: "4. å¥½ããªå¤œã®éã”ã—æ–¹ã¯ï¼Ÿ",
    a: ["ãƒ‘ãƒ¼ãƒ†ã‚£ãƒ¼", "æ˜ ç”»é‘‘è³", "æ˜Ÿã‚’çœºã‚ã‚‹"],
  },
  {
    q: "5. æœèµ·ãã¦æœ€åˆã«ã™ã‚‹ã“ã¨ã¯ï¼Ÿ",
    a: ["ã‚¹ãƒãƒ›ç¢ºèª", "ã‚¹ãƒˆãƒ¬ãƒƒãƒ", "ç‘æƒ³ãƒ»æ—¥è¨˜"],
  },
  {
    q: "6. å‹é”ã«ç›¸è«‡ã•ã‚ŒãŸã‚‰ï¼Ÿ",
    a: ["ç‡ç›´ã«ã‚¢ãƒ‰ãƒã‚¤ã‚¹", "è©±ã‚’èã", "è§£æ±ºç­–ã‚’ä¸€ç·’ã«è€ƒãˆã‚‹"],
  },
  {
    q: "7. å¥½ããªã‚¢ãƒ¼ãƒˆã‚„éŸ³æ¥½ã¯ï¼Ÿ",
    a: ["æ´¾æ‰‹ãƒ»åˆºæ¿€çš„", "è½ã¡ç€ã„ãŸã‚‚ã®", "å¥‡æŠœãƒ»ç‹¬å‰µçš„"],
  },
  {
    q: "8. æ—…è¡Œã§é‡è¦ãªã®ã¯ï¼Ÿ",
    a: ["ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ä½“é¨“", "è¦³å…‰ã‚¹ãƒãƒƒãƒˆå·¡ã‚Š", "ã‚†ã£ãã‚Šéã”ã™"],
  },
  {
    q: "9. å–§å˜©ã—ãŸã¨ãã¯ï¼Ÿ",
    a: ["æ„Ÿæƒ…çš„ã«åå¿œ", "è·é›¢ã‚’ç½®ã", "ç›¸æ‰‹ã«åˆã‚ã›ã‚‹"],
  },
  {
    q: "10. å®ãã˜ãŒå½“ãŸã£ãŸã‚‰ï¼Ÿ",
    a: ["å¤§ããä½¿ã†", "æŠ•è³‡ã™ã‚‹", "å¯„ä»˜ãƒ»å‹é”ã«åˆ†ã‘ã‚‹"],
  },
];

//------------------------------------------------------
// ã‚¿ã‚¤ãƒ—ãƒ‡ãƒ¼ã‚¿ï¼ˆç”»åƒè¾¼ã¿ï¼‰
//------------------------------------------------------
const types = [
  {
    name: "æ˜Ÿè¿½ã„äººã‚¿ã‚¤ãƒ—",
    text: "å¤¢ã‚„ç†æƒ³ã«å‘ã‹ã£ã¦ã¾ã£ã™ãé€²ã‚€ã€ãã‚‰ãã‚‰å¥½å¥‡å¿ƒã‚¿ã‚¤ãƒ—ã€‚å¿ƒãŒã¨ãã‚ãã‚‚ã®ã‚’è¦‹ã¤ã‘ã‚‹ã¨ä¸€ç›´ç·šã€‚æ–°ã—ã„ä¸–ç•Œã‚’é–‹ãåŠ›ãŒã‚ã‚‹ã‚ˆã€‚",
    img: "images/dream_chaser.png",
  },
  {
    name: "å½±èª­ã¿ã‚¿ã‚¤ãƒ—",
    text: "é™ã‹ã«è¦³å¯Ÿã—ã€çŠ¶æ³ã‚’æ·±ãç†è§£ã™ã‚‹æ´å¯Ÿã‚¿ã‚¤ãƒ—ã€‚äººã®æ°—æŒã¡ã«æ•æ„Ÿã§ã€æ…é‡ã ã‘ã©å„ªã—ã„è³¢è€…ã®ã‚ˆã†ãªå­˜åœ¨ã€‚",
    img: "images/shadow_reader.png",
  },
  {
    name: "éŸ³éŠã³ã‚¿ã‚¤ãƒ—",
    text: "æ„Ÿæ€§è±Šã‹ã§ã€è‡ªåˆ†ã‚‰ã—ã„ãƒªã‚ºãƒ ã‚’å¤§åˆ‡ã«ã™ã‚‹ã‚¯ãƒªã‚¨ã‚¤ãƒ†ã‚£ãƒ–ã‚¿ã‚¤ãƒ—ã€‚å¤¢ä¸­ã«ãªã‚‹ã¨ç‹¬è‡ªã®ä¸–ç•Œã‚’ç”Ÿã¿å‡ºã™æ‰èƒ½ã®æŒã¡ä¸»ã€‚",
    img: "images/sound_player.png",
  },
  {
    name: "é¢¨æ¥åŠã‚¿ã‚¤ãƒ—",
    text: "è‡ªç”±æ°—ã¾ã¾ã«ã€é¢¨ã®ã‚ˆã†ã«è»½ã‚„ã‹ã«ç”Ÿãã‚‹ã‚¿ã‚¤ãƒ—ã€‚å¿ƒåœ°ã‚ˆã„æµã‚Œã«èº«ã‚’ä»»ã›ã‚‹ã“ã¨ã§æœ¬æ¥ã®è¼ããŒå¢—ã—ã¦ã„ãã‚ˆã€‚",
    img: "images/wanderer.png",
  },
  {
    name: "ç‚å¿ƒã‚¿ã‚¤ãƒ—",
    text: "æƒ…ç†±çš„ã§ãƒ‘ãƒ¯ãƒ•ãƒ«ã€‚ç›®æ¨™ã‚’è¦‹ã¤ã‘ã‚‹ã¨å…¨åŠ›ã§çªãé€²ã‚€ãƒãƒ£ãƒ¬ãƒ³ã‚¸ãƒ£ãƒ¼ã‚¿ã‚¤ãƒ—ã€‚å‘¨ã‚Šã‚‚å…ƒæ°—ã«ã™ã‚‹æ˜ã‚‹ã„ã‚¨ãƒãƒ«ã‚®ãƒ¼ã®æŒã¡ä¸»ã€‚",
    img: "images/flame_heart.png",
  },
  {
    name: "é™è¬ã‚¿ã‚¤ãƒ—",
    text: "ç©ã‚„ã‹ã§å„ªã—ã„ç©ºæ°—ã‚’ã¾ã¨ã£ãŸç™’ã—ã‚¿ã‚¤ãƒ—ã€‚è½ã¡ç€ã„ãŸåˆ¤æ–­åŠ›ã‚’æŒã¡ã€ãã°ã«ã„ã‚‹ã ã‘ã§å®‰å¿ƒæ„Ÿã‚’ä¸ãˆã‚‹å­˜åœ¨ã€‚",
    img: "images/serenity.png",
  },
  {
    name: "å¤¢æ¡ˆå†…ã‚¿ã‚¤ãƒ—",
    text: "äººã‚’æ”¯ãˆã‚‹åŠ›ã«é•·ã‘ãŸã‚¬ã‚¤ãƒ‰ã‚¿ã‚¤ãƒ—ã€‚ç›¸æ‰‹ã«å¯„ã‚Šæ·»ã„ãªãŒã‚‰ã€ãã£ã¨èƒŒä¸­ã‚’æŠ¼ã—ã¦ã‚ã’ã‚‰ã‚Œã‚‹å„ªã—ã„ãƒªãƒ¼ãƒ€ãƒ¼æ°—è³ªã€‚",
    img: "images/dream_guide.png",
  },
  {
    name: "å½±éŸ¿è€…ã‚¿ã‚¤ãƒ—",
    text: "å¤ªé™½ã®ã‚ˆã†ã«æ˜ã‚‹ãã€å‘¨ã‚Šã‚’å…ƒæ°—ã«ã™ã‚‹å½±éŸ¿åŠ›ã‚¿ã‚¤ãƒ—ã€‚å‰å‘ããªè¡Œå‹•ã§è‡ªç„¶ã¨äººã‚’æƒ¹ãã¤ã‘ã‚‹ãƒ ãƒ¼ãƒ‰ãƒ¡ãƒ¼ã‚«ãƒ¼ã€‚",
    img: "images/influencer.png",
  },
];

//------------------------------------------------------
// ç›¸æ€§ãƒãƒˆãƒªã‚¯ã‚¹
//------------------------------------------------------
const compatibility = [
  [80, 60, 70, 75, 85, 50, 65, 70],
  [60, 80, 55, 50, 65, 85, 75, 60],
  [70, 55, 80, 65, 75, 60, 70, 65],
  [75, 50, 65, 80, 70, 55, 60, 75],
  [85, 65, 75, 70, 80, 60, 70, 80],
  [50, 85, 60, 55, 60, 80, 75, 60],
  [65, 75, 70, 60, 70, 75, 80, 65],
  [70, 60, 65, 75, 80, 60, 65, 80],
];

//------------------------------------------------------
// ã‚¹ã‚³ã‚¢ç®¡ç†
//------------------------------------------------------
let scores = Array(types.length).fill(0);
let current = 0;

//------------------------------------------------------
// è³ªå•ã‚’è¡¨ç¤º
//------------------------------------------------------
function showQuestion() {
  if (current >= questions.length) {
    showResult();
    return;
  }

  const qDiv = document.getElementById("quiz");
  qDiv.innerHTML = `<div class="question">${questions[current].q}</div>`;
  const qElem = qDiv.querySelector(".question");
  setTimeout(() => qElem.classList.add("show"), 50);

  questions[current].a.forEach((ans, idx) => {
    const btn = document.createElement("button");
    btn.innerText = ans;
    btn.onclick = () => selectAnswer(idx);
    qDiv.appendChild(btn);
  });
}

//------------------------------------------------------
// å›ç­”å‡¦ç†
//------------------------------------------------------
function selectAnswer(choice) {
  if (choice === 0) {
    [0, 3, 4].forEach((i) => scores[i]++);
  }
  if (choice === 1) {
    [1, 5, 6].forEach((i) => scores[i]++);
  }
  if (choice === 2) {
    [2, 7].forEach((i) => scores[i]++);
  }

  current++;
  showQuestion();
}

//------------------------------------------------------
// çµæœã‚’è¡¨ç¤º
//------------------------------------------------------
function showResult() {
  const rDiv = document.getElementById("result");
  rDiv.style.display = "block";

  const maxScore = Math.max(...scores);
  const idx = scores.indexOf(maxScore);
  const userType = types[idx];

  // æ–°ã—ã„ç›¸æ€§åˆ¤å®šï¼ˆBEST1/WORST1ï¼‰
  const { best, worst } = getBestAndWorstCompatibility(userType);

  rDiv.innerHTML = `
    <h2>ã‚ãªãŸã®ã‚¿ã‚¤ãƒ—ã¯ ${userType.name}ï¼</h2>
    <img src="${userType.img}">
    <p>${userType.text}</p>

    <div class="compatibility-block">
      <h3>â¤ï¸ ç›¸æ€§ãŒã„ã„ã‚¿ã‚¤ãƒ—ï¼ˆãƒ™ã‚¹ãƒˆ1ï¼‰</h3>
      <p><b>${best.name}</b>ï¼ˆ${best.rank}ï¼‰<br>${best.desc}</p>

      <h3>ğŸ’” ç›¸æ€§ãŒæ‚ªã„ã‚¿ã‚¤ãƒ—ï¼ˆãƒ¯ãƒ¼ã‚¹ãƒˆ1ï¼‰</h3>
      <p><b>${worst.name}</b>ï¼ˆ${worst.rank}ï¼‰<br>${worst.desc}</p>
    </div>
  `;

  rDiv.classList.add("show");


  // è³ªå•ã‚¨ãƒªã‚¢ã¯æ¶ˆã™
  document.getElementById("quiz").innerHTML = "";
}

function getBestAndWorstCompatibility(typeObj) {
  const comp = typeObj.compatibility;

  // rank ã‚’æ•°å€¤åŒ–ã—ã¦å¤§å°æ¯”è¼ƒã—ã‚„ã™ãã™ã‚‹
  const rankValue = { "â—": 3, "ã€‡": 2, "â–³": 1 };

  const list = Object.entries(comp).map(([name, info]) => ({
    name,
    rank: info.rank,
    desc: info.desc,
    value: rankValue[info.rank]
  }));

  // ç›¸æ€§ãŒè‰¯ã„ BEST1ï¼ˆæœ€å¤§å€¤ï¼‰
  const best = list.reduce((a, b) => (a.value > b.value ? a : b));

  // ç›¸æ€§ãŒæ‚ªã„ WORST1ï¼ˆæœ€å°å€¤ï¼‰
  const worst = list.reduce((a, b) => (a.value < b.value ? a : b));

  return { best, worst };
}
